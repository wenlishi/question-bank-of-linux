# 极智考典 - 新版授权系统使用指南

## 概述

新版授权系统采用**机器码 + 注册码**模式，提供更安全、更灵活的软件授权管理。

## 系统架构

### 1. 核心组件
- **客户端** (`license_manager.py`) - 用户软件中的授权验证模块
- **注册机** (`admin/license_generator.py`) - 管理员使用的注册码生成工具
- **授权对话框** (`ui/license_dialog.py`) - 用户界面交互

### 2. 工作流程
```
用户端：                                    管理员端：
1. 运行软件生成机器码                     1. 运行注册机工具
2. 复制机器码发送给管理员                 2. 输入用户机器码
3. 接收管理员发来的注册码                 3. 设置有效期等信息
4. 输入注册码激活软件                     4. 生成注册码
5. 软件验证注册码并保存授权               5. 发送注册码给用户
```

## 安装和配置

### 1. 安装依赖
```bash
# 安装PyQt5
pip install PyQt5>=5.15.0

# 安装加密模块
pip install pycryptodome>=3.15.0

# 安装打包工具
pip install pyinstaller
```

### 2. 配置RSA密钥
1. 运行注册机：`python admin/license_generator.py`
2. 点击"生成新密钥"按钮
3. 复制公钥到 `user_version/core/license_manager.py` 中的 `public_key_pem` 变量
4. **妥善保管私钥**，不要泄露

## 使用方法

### 1. 用户激活流程
1. **首次运行软件**：
   - 软件自动生成机器码
   - 显示授权对话框
   - 用户复制机器码

2. **获取注册码**：
   - 将机器码发送给软件提供商
   - 提供商使用注册机生成注册码
   - 接收提供商发回的注册码

3. **激活软件**：
   - 在授权对话框中输入注册码
   - 点击"激活授权"按钮
   - 软件验证并保存授权信息

### 2. 管理员操作流程
1. **运行注册机**：
   ```bash
   python admin/license_generator.py
   ```

2. **生成注册码**：
   - 在"生成注册码"标签页输入用户机器码
   - 设置有效期（默认365天）
   - 点击"生成注册码"按钮
   - 复制生成的注册码发送给用户

3. **批量生成**（可选）：
   - 在"批量生成"标签页设置数量和有效期
   - 点击"批量生成注册码"按钮
   - 保存生成的注册码列表

### 3. 打包软件
```bash
# 使用打包脚本
build_user_version.bat

# 或手动打包
cd user_version
pyinstaller --onefile --windowed --name="极智考典" --add-data="data;data" --add-data="ui;ui" --add-data="core;core" main.py
```

## 技术细节

### 1. 机器码生成
基于以下硬件信息生成唯一机器码：
- 硬盘序列号
- MAC地址
- 计算机名
- 主板序列号（如果可用）
- CPU ID（如果可用）

### 2. 注册码加密
使用RSA非对称加密：
- **公钥**：嵌入在客户端代码中，用于验证注册码
- **私钥**：仅管理员持有，用于生成注册码

### 3. 授权存储
- 授权信息保存在本地加密文件中
- 文件位置：`%APPDATA%\TikuSoft\极智考典\licenses\license.lic`
- 包含机器码、注册码、有效期等信息

## 常见问题

### Q1: 机器码会变化吗？
**A**: 一般情况下不会变化，除非：
- 更换硬盘
- 更换网卡（MAC地址变化）
- 重装系统（计算机名变化）

### Q2: 更换设备怎么办？
**A**: 需要重新授权：
1. 在新设备上运行软件获取新机器码
2. 联系管理员生成新注册码
3. 在新设备上激活

### Q3: 授权过期怎么办？
**A**: 软件到期前30天会显示提醒，需要：
1. 联系管理员续费
2. 获取新的注册码
3. 重新激活软件

### Q4: 注册码验证失败？
**A**: 可能原因：
1. 注册码与机器码不匹配
2. 注册码已过期
3. 系统时间不正确
4. 授权文件损坏

### Q5: 如何清除授权？
**A**: 删除授权文件：
- Windows: `%APPDATA%\TikuSoft\极智考典\licenses\license.lic`
- 或运行软件时按住Shift键跳过授权（如果实现）

## 安全建议

### 1. 密钥管理
- **定期更换RSA密钥**，建议每6-12个月更换一次
- **分开存储公钥和私钥**，私钥不要嵌入代码中
- **备份私钥**，防止丢失

### 2. 注册码管理
- 记录生成的注册码和对应的机器码
- 设置合理的有效期
- 定期清理过期的注册码记录

### 3. 客户端安全
- 使用代码混淆工具保护Python代码
- 定期更新软件版本
- 监控异常激活行为

## 故障排除

### 1. 注册机无法运行
```bash
# 检查依赖
pip list | findstr PyQt5
pip list | findstr pycryptodome

# 重新安装依赖
pip install --upgrade PyQt5 pycryptodome
```

### 2. 打包后授权失败
- 检查PyInstaller是否包含所有必要模块
- 确保数据文件正确打包
- 测试开发环境和打包环境的授权流程

### 3. 机器码生成失败
- 检查系统权限（可能需要管理员权限）
- 查看系统日志中的错误信息
- 使用备用机器码生成方法

## 更新日志

### v2.0 (新版授权系统)
- 采用机器码 + 注册码模式
- 增加RSA非对称加密
- 改进硬件信息采集
- 添加批量生成功能
- 优化用户界面

### v1.0 (旧版激活系统)
- 简单的激活码验证
- 对称加密存储
- 有限的安全性

## 技术支持

如有问题，请提供以下信息：
1. 软件版本
2. 操作系统版本
3. 错误信息截图
4. 机器码（如果可用）

联系邮箱：support@tikusoft.com
官方网站：https://www.tikusoft.com